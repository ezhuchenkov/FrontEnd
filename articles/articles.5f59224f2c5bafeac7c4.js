!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=17)}([function(e,t,s){"use strict";s.d(t,"j",(function(){return r})),s.d(t,"k",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"a",(function(){return n})),s.d(t,"h",(function(){return a})),s.d(t,"g",(function(){return l})),s.d(t,"f",(function(){return d})),s.d(t,"e",(function(){return c})),s.d(t,"b",(function(){return u})),s.d(t,"d",(function(){return h})),s.d(t,"i",(function(){return m}));document.querySelector(".results"),document.querySelector(".header__form"),document.querySelector(".results__news");const r={signUpUrl:"http://localhost:3000/signup",signInUrl:"http://localhost:3000/signin",articlesUrl:"http://localhost:3000/articles",getUserInfoUrl:"http://localhost:3000/users/me",logoutUrl:"http://localhost:3000/logout"},i={mainUrl:"https://newsapi.org/v2/everything?",apiKey:"apiKey=05ef796b6e4f4d7bb3e42754e27ddafe&",calculationDate:new Date(new Date-6048e5),pageSize:"pageSize=100",langOption:"lang=ru&"},o="/",n="/articles/",a="signUp",l="signIn",d=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],c=767,u=27,h=3,m={card:{card:"card",cardImage:"card__image",cardPopup:"card__popup",cardPopupTextLogin:"Войдите, чтобы сохранять статьи",cardPopupTextDelete:"Убрать из сохраненных",cardPopupTextSave:"Сохранить",cardIcon:"card__icon",cardIconDelete:"card__icon_delete",cardIconAdd:"card__icon_add",cardKeyword:"card__keyword",cardDescription:"card__description",cardDate:"card__date",cardTitle:"card__title",cardText:"card__text",cardSource:"card__source"},container:".results__news",button:"button",resultSection:".results",popups:{popup:".popup",popupRegistration:"#signUp",popupSignUpSuccess:"#signUpSuccess",popupSignIn:"#signIn",popupHide:"popup_hide",errors:{requiredArea:"Это обязательное поле",passLength:"Длина пароля должна быть 8 или более символов",nameLength:"Имя должно быть не менее 2 символов",emailValidation:"Введите корректный адрес e-mail"},serverErrors:{checked:"Произошла ошибка обработки данных",unchecked:"Произошла непредваиденная ошибка",unauthorized:"Неправильный логин или пароль"}},authForm:{authForm:".auth-form",signin:"#signIn-form",registredSignin:"#registred-signIn-form",signup:"#signUp-form",close:"auth-form__close",input:"auth-form__input",errorMessage:"auth-form__error-message",inputs:{email:"email",name:"name",password:"password"}},savedArticles:{title:".saved-articles__title",keywords:".saved-articles__keyword",firstKeyWord:".saved-articles__keyword_first",secondKeyWord:".saved-articles__keyword_second",countKeyWord:".saved-articles__keyword_count",otherKeyWord:".saved-articles__keyword_other"},menu:{menu:".menu",loggedLink:".menu__link_logged",mobileMenu:".menu__mobile",mobileMenuClose:"menu__mobile_close",mobileMenuCloseblack:"menu__mobile_close_black",mobileMenuItem:".menu__items-list"},header:{userNameButton:"#username",logoutIcon:".menu__logout",articlesButton:"#articles",headerForm:".header__form",inputArea:".header__form-input",inputErrorPopup:"header__form-input_error",inputErrorPopupText:"Поле поиска не может быть пустым"},results:{button:"results__button",buttonText:"Показать еще",buttonHide:"button_hide",news:"results__news",hide:"results_hide",title:"title",titleText:"Результаты поиска"},preloader:{preloaderSection:".preloader",preloaderBox:"preloader__box",preloaderBoxCircle:"preloader__box_preloaderCircle",preloaderBoxNoNews:"preloader__box_noNews",preloaderBoxError:"preloader__box_error",preloaderCircle:"preloader__circle",preloaderSubtitle:"preloader__subtitle",preloaderSubtitleFindText:"Идет поиск новостей...",preloaderSubtitleNotFoundText:"К сожалению по вашему запросу ничего не найдено.",preloaderSubtitleErrorText:"К сожалению по вашему запросу ничего не найдено.",preloaderIcon:"preloader__icon",preloaderIconSrc:"./images/not-found.svg",preloaderIconAlt:"Ничего не найдено.",preloaderTitle:"title",preloaderTitleText:"Ошибка"},overlay:{overlay:".overlay",overlayOn:"overlay_on"}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(0);class i{constructor(){this.domElements=r.i,this.userNameButton=document.querySelector(r.i.header.userNameButton),this.logoutIcon=document.querySelector(r.i.header.logoutIcon),this.articlesButton=document.querySelector(r.i.header.articlesButton),this.resultSection=document.querySelector(r.i.resultSection),this.headerForm=document.querySelector(r.i.header.headerForm),this.container=document.querySelector(this.domElements.container),this.preloaderSection=document.querySelector(r.i.preloader.preloaderSection),this.menuItems=document.querySelector(this.domElements.menu.mobileMenuItem),this.menuControl=document.querySelector(this.domElements.menu.mobileMenu),this.menu=document.querySelector(this.domElements.menu.menu)}addlistener(e,t,s){e.addEventListener(t,s)}removelistener(e,t,s){e.removeEventListener(t,s)}isLogged(){return Boolean(localStorage.getItem("user"))}}},function(e,t,s){},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r=s(1),i=s(0);class o extends r.a{constructor(e){super(),this._header=e.header,this._popupRegistration=e.popupRegistration,this._popupSignIn=e.popupSignIn,this._popupSignUpSuccess=e.popupSignUpSuccess,this._logout=e.logout,this._menu=e.menu}render(){this._header({isLoggedIn:this.isLogged(),name:localStorage.getItem("user")}),this._addLiteners()}_addLiteners(){this.addlistener(document.querySelector(this.domElements.menu.loggedLink),"click",()=>{this.logging()}),this.addlistener(document.querySelector(this.domElements.menu.mobileMenu),"click",()=>{this._menu.click()}),window.addEventListener("resize",()=>{window.innerWidth>i.e&&this._menu.close()}),document.location.pathname===i.c&&(this.addlistener(document.querySelector(this.domElements.authForm.signin),"click",e=>{this._popupRegistration.close(),this._popupSignUpSuccess.close(),this._popupSignIn.open(e)}),this.addlistener(document.querySelector(this.domElements.authForm.registredSignin),"click",e=>{this._popupSignUpSuccess.close(),this._popupSignIn.open(e)}),this.addlistener(document.querySelector(this.domElements.authForm.signup),"click",e=>{this._popupSignIn.close(),this._popupRegistration.open(e)}))}logging(){this.isLogged()?(this._logout(),localStorage.clear(),this._header({isLoggedIn:!1,name:null})):this._popupRegistration.open()}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r=s(1),i=s(0);class o extends r.a{constructor(e,t,s){super(),this._options=t,this._title=s,this._preloader=this._options.preloader,this.headerForm&&(this.inputArea=this.headerForm.querySelector(this.domElements.header.inputArea),this.findButton=this.headerForm.querySelector(`.${this.domElements.button}`),this.addlistener(this.headerForm,"submit",e=>this._takeNews(e))),this._isResults=this._isResults.bind(this),this._noResults=this._noResults.bind(this),this._cardList=t.cardList,this._news=[],this._apiMethod=e,this._counter=3,this._showMoreNewsLimiter=3}_isResults(){const e=document.createElement("h3"),t=document.createElement("div"),s=document.createElement("button");this.resultSection.classList.remove(this.domElements.results.hide),e.classList.add(this.domElements.results.title),e.textContent=this.domElements.results.titleText,this.resultSection.appendChild(e),t.classList.add(this.domElements.results.news),this.resultSection.appendChild(t),s.classList.add(this.domElements.button),s.classList.add(this.domElements.results.button),s.textContent=this.domElements.results.buttonText,this.resultSection.appendChild(s),s.addEventListener("click",()=>{this._takeMoreNews()})}_disableForm(){this.inputArea.setAttribute("disabled",!0),this.findButton.setAttribute("disabled",!0)}_enableForm(){this.inputArea.removeAttribute("disabled"),this.findButton.removeAttribute("disabled")}_noResults(){this.resultSection.classList.add(this.domElements.results.hide),this._cleanResults()}_cleanResults(){for(this._counter=3;this.resultSection.firstChild;)this.resultSection.removeChild(this.resultSection.firstChild)}_checkEmptyInputError(e){if(0!==e.length)return!1;const t=document.createElement("i");return t.classList.add(this.domElements.header.inputErrorPopup),t.textContent=this.domElements.header.inputErrorPopupText,this.headerForm.appendChild(t),!0}_emptyInputErrorOff(){const e=this.headerForm.querySelector(`.${this.domElements.header.inputErrorPopup}`);e&&this.headerForm.removeChild(e)}_formatDate(e){const t=new Date(e),s=t.getFullYear(),r=t.getMonth()+1;return`${t.getDate()} ${i.f[r]}, ${s}`}_takeNews(e){e.preventDefault();const t=this.inputArea.value;this._counter=3,this._news=[],this._checkEmptyInputError(t)||(this._disableForm(),this._emptyInputErrorOff(),this._preloader.circleOn(),this._preloader.noNewsOff(),this._preloader.errorOff(),this._cleanResults(),this._apiMethod(t).then(e=>{if([...e.articles].forEach(e=>{this._news.push({source:e.source.name,title:e.title,date:this._formatDate(e.publishedAt),text:e.description,image:e.urlToImage,link:e.url,keyword:t})}),0===e.length)this._preloader.noNewsOn(),this._noResults();else{this._isResults();for(let e=0;e<this._counter;e+=1)this._cardList(this._news[e].source,this._news[e].title,this._news[e].date,this._news[e].text,this._news[e].image,this._news[e].link,this._news[e].keyword,this._options);this._preloader.circleOff(),this._enableForm()}}))}_takeMoreNews(){const e=this._news.length-this._counter,t=e<this._showMoreNewsLimiter?e:this._showMoreNewsLimiter;e<=this._showMoreNewsLimiter&&document.querySelector(`.${this.domElements.results.button}`).classList.add(this.domElements.results.buttonHide);for(let e=0;e<t;e+=1)this._cardList(this._news[this._counter].source,this._news[this._counter].title,this._news[this._counter].date,this._news[this._counter].text,this._news[this._counter].image,this._news[this._counter].link,this._news[this._counter].keyword,this._options),this._counter+=1}renderArticles(){this._apiMethod().then(e=>{0===e.data.length?this._noResults():Array.prototype.slice.apply(e.data).forEach(e=>{this._cardList(e._id,e.source,e.title,e.date,e.text,e.image,e.link,e.keyword,this._options)})})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(0);class i{constructor(){this._signUpUrl=r.j.signUpUrl,this._signInUrl=r.j.signInUrl,this._articlesUrl=r.j.articlesUrl,this._getUserInfoUrl=r.j.getUserInfoUrl,this._logoutUrl=r.j.logoutUrl}signUp(e){return fetch(this._signUpUrl,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include",body:JSON.stringify(e)})}signIn(e){return fetch(this._signInUrl,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include",body:JSON.stringify(e)})}getArticles(){return fetch(this._articlesUrl,{credentials:"include"}).then(e=>{if(!e.ok)throw new Error(`Ошибка: ${e.status}`);return e.json().catch(e=>{console.log(e.message)})})}getUserInfo(){return fetch(this._getUserInfoUrl,{credentials:"include"}).then(e=>{if(!e.ok)throw new Error(`Ошибка: ${e.status}`);return e.json()}).then(e=>e.user).catch(e=>{console.log(e.message)})}logout(){return fetch(this._logoutUrl,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include"}).then(e=>{if(!e.ok)throw new Error(`Ошибка: ${e.status}`);return e.json()}).catch(e=>{console.log(e.message)})}saveArticle(e){return fetch(this._articlesUrl,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include",body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error(`Ошибка сохранения карточки ${e.status}`);return e.json()}).then(e=>e._id).catch(e=>{console.log(e.message)})}removeArticle(e){return fetch(`${this._articlesUrl}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include"}).then(e=>{if(!e.ok)throw new Error(`Ошибка ${e.status}`);return e.json()}).catch(e=>{console.log(e.message)})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(1);class i extends r.a{constructor(){super()}render(e){const{isLoggedIn:t}=e,{name:s}=e;this._renderUser(s),t?this._articlesLinkActivate():this._articlesLinkDeactivate()}_renderUser(e){this.userNameButton.textContent=null===e?"Авторизоваться":e}_articlesLinkActivate(){this.articlesButton.style.display="flex",this.logoutIcon.style.display="flex"}_articlesLinkDeactivate(){this.articlesButton.style.display="none",this.logoutIcon.style.display="none","/articles/"===document.location.pathname&&window.location.replace("../")}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));s(11);var r=s(1);class i extends r.a{constructor(e,t){super(),this._isOpened=!1,this._overlay=e,this._isBlack=t}click(){this._isOpened?this._close():this._open()}_open(){this.menuControl.classList.add(this.domElements.menu.mobileMenuClose),this._isBlack&&this.menuControl.classList.add(this.domElements.menu.mobileMenuCloseblack),this._overlay.on(),this.menu.classList.add(this._isBlack?"menu_on-top_black":"menu_on-top"),this.menuItems.classList.add("menu__items-list_show"),this._isBlack&&(this.menuItems.style.background="white"),this._isOpened=!0}close(){this.menuControl.classList.remove(this.domElements.menu.mobileMenuClose),this._isBlack&&this.menuControl.classList.remove(this.domElements.menu.mobileMenuCloseblack),this._overlay.off(),this.menu.classList.remove("menu_on-top"),this.menu.classList.remove("menu_on-top_black"),this.menuItems.classList.remove("menu__items-list_show"),this._isOpened=!1}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(0);class i{constructor(){this._overlay=document.querySelector(r.i.overlay.overlay)}on(){this._overlay.classList.add(r.i.overlay.overlayOn)}off(){this._overlay.classList.remove(r.i.overlay.overlayOn)}}},function(e,t,s){"use strict";s(2);var r=s(1),i=s(0);class o extends r.a{constructor(e,t,s,r,i,o,n,a){super(),this._source=e,this._title=t,this._date=s,this._text=r,this._image=i,this._link=o,this._keyword=n,this._options=a}create(e,t){const s=document.createElement("a"),r=document.createElement("div"),o=document.createElement("div"),n=document.createElement("i"),a=document.createElement("div"),l=document.createElement("p"),d=document.createElement("h4"),c=document.createElement("p"),u=document.createElement("p");s.classList.add(this.domElements.card.card),s.href=this._link,r.classList.add(this.domElements.card.cardImage),this._image?r.style=`background-image: url(${this._image})`:r.style="background-image: url(../../../images/noImage.png)",s.appendChild(r),n.classList.add(this.domElements.card.cardPopup),o.classList.add(this.domElements.card.cardIcon),document.location.pathname===i.a?(o.classList.add(this.domElements.card.cardIconDelete),n.textContent=this.domElements.card.cardPopupTextDelete,this.addlistener(o,"click",s=>{this._remove(s,e,t),o.removeEventListener("click",this._remove);const i=document.createElement("i");i.classList.add(this.domElements.card.cardKeyword),i.textContent=this._keyword,r.appendChild(i)})):this.isLogged()?(n.textContent=this.domElements.card.cardPopupTextSave,this.addlistener(o,"click",e=>this._iconListener(e,o))):n.textContent=this.domElements.card.cardPopupTextLogin,r.appendChild(o),r.appendChild(n),a.classList.add(this.domElements.card.cardDescription),s.appendChild(a),l.classList.add(this.domElements.card.cardDate),l.textContent=this._date,a.appendChild(l),d.classList.add(this.domElements.card.cardTitle),d.textContent=this._title,a.appendChild(d),c.classList.add(this.domElements.card.cardText),c.textContent=this._text,a.appendChild(c),u.classList.add(this.domElements.card.cardSource),u.textContent=this._source,s.appendChild(u),this.container.appendChild(s)}_iconListener(e,t){e.target.classList.value===`${this.domElements.card.cardIcon} ${this.domElements.card.cardIconAdd}`?this._unSave(e).then(()=>{t.classList.remove(this.domElements.card.cardIconAdd)}):this._save(e).then(e=>{e&&t.classList.add(this.domElements.card.cardIconAdd)})}_remove(e,t,s){e.preventDefault(),this._options.removeArticle(t).then(()=>{s(),this.container.removeChild(e.target.closest(`.${this.domElements.card.card}`))})}_save(e){e.preventDefault();const t={keyword:this._keyword,title:this._title,text:this._text,date:this._date,source:this._source,link:this._link,image:this._image};return this._options.saveArticle(t)}_unSave(e){e.preventDefault();const t=[];return this._options.getArticles().then(e=>{[...e.data].forEach(e=>{t.push(e)}),t.forEach(e=>{e.link===this._link&&this._options.removeArticle(e._id)})})}}class n extends o{constructor(e,t,s,r,i,o,n,a,l,d){super(t,s,r,i,o,n,a,l),this._id=e,this._titleRender=d}create(){super.create(this._id,this._titleRender)}}s.d(t,"a",(function(){return a}));class a{constructor(e){this._title=e}addCard(e,t,s,r,i,n,a,l){new o(e,t,s,r,i,n,a,l).create()}addArticle(e,t,s,r,i,o,a,l,d){new n(e,t,s,r,i,o,a,l,d,this._title).create()}}},function(e,t,s){},function(e,t,s){},,,,function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(10),s(15);var r=s(3),i=s(4),o=s(5),n=(s(2),s(0));var a=s(6),l=s(9),d=s(7),c=s(8);const u=new o.a,h=u.getArticles.bind(u),m=new class{constructor(e,t){this._name=e,this._title=document.querySelector(n.i.savedArticles.title),this._keywords=document.querySelector(n.i.savedArticles.keywords),this._firstKeyWord=document.querySelector(n.i.savedArticles.firstKeyWord),this._secondKeyWord=document.querySelector(n.i.savedArticles.secondKeyWord),this._countKeyWord=document.querySelector(n.i.savedArticles.countKeyWord),this._otherKeyWord=document.querySelector(n.i.savedArticles.otherKeyWord),this._articles=t}render(){this._popularWordsCounter()}_popularWordsCounter(){const e=[];this._articles().then(t=>{[...t.data].forEach(t=>{e.push(t.keyword)}),this._title.textContent=`${this._name}, у Вас ${t.data.length} сохраненных статей`;const s=[];for(const t in e)void 0!==s[e[t]]?s[e[t]]+=1:s[e[t]]=1;const r={words:[],key:"",max:0},i=Array.from(Object.keys(s)).length,o=i>=n.d?n.d:i;for(let e=0;e<o;e+=1)Array.from(Object.keys(s)).forEach(e=>{r.max<s[e]&&(r.max=s[e],r.key=e)}),delete s[r.key],r.words.push(r.key),r.max=0,r.key="";this._statUpdate(r.words,i)})}_statUpdate(e,t){switch(t){case 0:this._firstKeyWord.textContent="",this._otherKeyWord.style.display="none";break;case 1:this._firstKeyWord.textContent=e.shift(),this._secondKeyWord.textContent="",this._otherKeyWord.style.display="none";break;case 2:this._firstKeyWord.textContent=`${e.shift()},`,this._secondKeyWord.textContent=e.shift(),this._otherKeyWord.style.display="none";break;default:this._firstKeyWord.textContent=`${e.shift()},`,this._secondKeyWord.textContent=e.shift(),this._countKeyWord.textContent=`и ${t-2}`,this._otherKeyWord.style.display="auto"}}}(localStorage.getItem("user"),h);m.render();const _=new a.a,p=new c.a,g=new d.a(p,!0),f=new l.a(m.render.bind(m));new i.a(h,{isLoggedIn:Boolean(localStorage.getItem("user")),cardList:f.addArticle.bind(f),removeArticle:u.removeArticle.bind(u),getArticles:h},m.render.bind(m)).renderArticles();new r.a({header:_.render.bind(_),logout:u.logout.bind(u),menu:g}).render()}]);